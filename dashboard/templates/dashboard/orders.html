{% extends "dashboard/base.html" %}

{% load static %}


{% block basebody %}
{% load custom_tags %}

 

    


        <!-- NEW Order -->
    <h1 class="mt-5">New Order</h1>
    <div class="border rounded p-2 mt-2 mb-5 ">
        
        <form method="POST">
            {% csrf_token %}

            <div class="d-flex justify-content-between gap-2 flex-sm-row flex-column ">

                <div class="d-flex justify-content-start">
                    <p>Name:</p>
                    <input type="text" class="form-control form-control-sm" name="new_order_name" value="{{new_random_name}}" required/>
                </div>


                
                <div class="d-flex justify-content-start">

                    <select class="form-select form-select-sm" id="new_position_coin_select" style="height: 30px;"  name="coin"  required>
                        
                            {% for coin in coins %}
                                <option value="{{coin}}">{{coin}}</option>
                            {% endfor %}

                    </select>
                </div>
    
                    


                <div class="d-flex justify-content-start">
                    <p>Entry capital:</p>
                    <input type="number" class="form-control form-control-sm" name="entry_capital" id="entry_capital" step="any" required/>
                </div>
            </div>

            
            <div class="d-flex justify-content-between gap-2 flex-sm-row flex-column ">

                <div class="d-flex justify-content-start">
                    <p>Order price:</p>
                    <input type="number" class="form-control form-control-sm"  step="any" min="0" value="0" name="order_price"/>
                </div>

                <div class="d-flex justify-content-start" > 
                    <p>Stop loss price:</p>
                    <input type="number" class="form-control form-control-sm" name="stop_loss_price" value="3000" id="stop_loss_price" step="any" required/>
                </div>

                <div class="d-flex justify-content-start gap-2 ">
                    <p>Min profit exit price:</p>
                    <input type="number" class="form-control form-control-sm" name="min_profit_exit_price" value="10000" id="min_profit_exit_price" step="any" required/>
                </div>

            </div>

            
            <div class="d-flex justify-content-between gap-2  flex-sm-row flex-column ">
                <p id="profit_amount_at_min_profit_exit_price"></p>
                <p id="loss_amount_at_stop_loss_price"></p>
                <p id="ambition_ratio"></p>
            </div>

            <div class="d-flex justify-content-between">
                
                <div class="d-flex justify-content-start">
                    <p id="most_recent_quote"></p>
                    <button type="button"  class="btn btn-primary btn-sm ms-3" onclick="update_both_way_quotes();">Quote</button>
                </div>
            </div>


            <div class="d-flex justify-content-between gap-2 mt-2  flex-sm-row flex-column ">

                


                <div class="d-flex justify-content-start">
                    <p>Order mode:</p>
                    <select class="form-select" name="order_mode">
                        {% for order_mode in order_modes %}
                            <option value="{{order_mode}}" {% if order_mode == 'buy_if_price_is_below' %} selected {% endif %}>{{order_mode}}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="d-flex justify-content-end">
                    <button class="btn btn-success btn-sm gas_sensetive_dom" >Place order</button>
                </div>
            </div>

                
        </form>

    </div>






    <!-- ORDERS -->
    <h1>Orders ({{orders|length}})</h1>
    
    {% for order in orders %}

        


            <div class="border rounded p-2 mb-5">



                <form method="POST" >
                    {% csrf_token %}

                    <input type="text" name="update_order" hidden>
                    <input type="text" name="order_uuid" value="{{order.uuid}}" hidden>

                    <div class="d-flex justify-content-between  flex-sm-row flex-column gap-2">

                        <div>
                            <input type="text" class="form-control form-control-sm" name="order_action_set_name" value="{{order.name}}" style="width: 200px;"/>
                            <p class="small m-0">({{order.coin}})</p>
                            <p class="small m-0">Mode: {{order.mode}}</p>
                            <p class="small m-0">Active: {{order.active}}</p>
                            <p class="small m-0">Executed: {{order.executed}}</p>
                            <p class="small m-0">Fullfiled: {{order.fullfiled}}</p>
                        </div>

                        <div>
                            <p>entry capital:</p>
                            <input type="number" class="form-control form-control-sm" name="order_action_set_entry_capital" value="{{order.entry_capital}}" style="width: 100px;"  step="any"/>
                        </div>


                        <div>
                            <p>order price:</p>
                            <input type="number" class="form-control form-control-sm" name="order_action_set_order_price" value="{{order.order_price}}" style="width: 100px;"  step="any"/>

                        </div>
                    </div>
                    <div class="d-flex justify-content-between  flex-sm-row flex-column gap-2">

                        <div>
                            <p>min_profit_exit_price:</p>
                            <input type="number" class="form-control form-control-sm" name="order_action_set_min_profit_exit_price" value="{{order.min_profit_exit_price}}" style="width: 100px;"  step="any"/>
                        </div>

                        <div>
                            <p>stop_loss_price:</p>
                            <input type="number" class="form-control form-control-sm" name="order_action_set_stop_loss_price" value="{{order.stop_loss_price}}" style="width: 100px;"  step="any"/>
                        </div>

                        <button class="btn btn-primary btn-sm m-1" >set</button>

                    </div>


                    
                </form>



                <div class="d-flex justify-content-start border rounded p-1 gap-2 flex-sm-row flex-column ">

                    <!-- <form method="POST"> -->
                        <!-- {% csrf_token %} -->
                        <!-- <input type="text" name="order_uuid" value="{{order.uuid}}" hidden> -->
                        {% if order.active %}
                            
                            <button type="button" class="btn btn-primary btn-danger btn-sm m-1 disable_while_busy"  onclick="execute_order('{{order.uuid}}')">Execute now</button>


                        {% endif %}
                    <!-- </form> -->


                    {% if order.executed %}
                        <form method="POST">
                            {% csrf_token %}
                            <input type="text" name="order_uuid" value="{{order.uuid}}" hidden>

                            <button class="btn btn-primary btn-warning btn-sm m-1" name="order_archive">Archive order</button>
                        </form>

                    {% else %}
                        <form method="POST">
                            {% csrf_token %}
                            <input type="text" name="order_uuid" value="{{order.uuid}}" hidden>

                            <button class="btn btn-primary btn-danger btn-sm m-1" name="order_delete">Delete order</button>
                        </form>
                    {% endif %}


                    <form method="POST">
                        {% csrf_token %}
                        <input type="text" name="order_uuid" value="{{order.uuid}}" hidden>
                        {% if order.active %}
                            <button class="btn btn-primary  btn-success btn-sm m-1" name="order_deactivate">Deactivate order</button>
                        {% else %}
                            <button class="btn btn-primary btn-secondary btn-sm m-1" name="order_activate">Activate order</button>

                        {% endif %}
                    </form>


                </div>

            </div>


    {% endfor %}





    
    <script>


        $(document).ready(function () {

            setup_ws_dashboard();

        })

    </script>


    



{% endblock %}
